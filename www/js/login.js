// Generated by CoffeeScript 1.9.3
(function() {
  angular.module('starter.services', []).factory('LoginService', function($rootScope) {
    var data, login, logout;
    data = {
      token: 'none'
    };
    login = function() {
      var clientId, ref;
      clientId = "576f5522-9b0c-4f1a-82d4-4b4fbb7272bc";
      ref = window.open('https://api.moj.io/OAuth2/authorize?client_id=' + clientId + '&redirect_uri=http://localhost/callback&response_type=token', '_blank', 'location=no,presentationstyle=fullscreen,hardwareback=no,clearsessioncache=yes,clearcache=yes');
      ref.addEventListener('loadstart', function(event) {
        if (event.url.indexOf("http://localhost/callback") === 0) {
          ref.removeEventListener("exit", (function(event) {}));
          ref.close();
          console.log("Event url: " + event.url);
          if (event.url.indexOf("access_token=") >= 0) {
            if ($rootScope.data == null) {
              $rootScope.data = {};
            }
            $rootScope.data.LoggedIn = true;
            return $rootScope.$apply((function() {
              return data.token = event.url.split("access_token=")[1].split("&")[0];
            }));
          }
        }
      });
      ref.addEventListener('loadstop', function() {
        return console.log('Load Stop!');
      });
      ref.addEventListener('exit', function(event) {
        return console.log('Exit! ');
      });
      return console.log('Login setup complete. ');
    };
    logout = function() {
      var clientId, ref;
      $rootScope.data.LoggedIn = false;
      data.token = "none";
      ref = null;
      console.log('Logout: ');
      clientId = "576f5522-9b0c-4f1a-82d4-4b4fbb7272bc";
      ref = window.open('https://api.moj.io/account/logout?Guid=' + data.token + '&client_id=' + clientId + '&redirect_uri=http://localhost/callback', '_blank', 'location=no,hidden=yes,hardwareback=no');
      ref.addEventListener('loadstart', function(event) {
        return console.log('Logout started. ' + JSON.stringify(event));
      });
      ref.addEventListener('loaderror', function(event) {
        console.log('Logout error. ' + JSON.stringify(event));
        $rootScope.data.LoggedIn = false;
        ref.close();
        return login();
      });
      return ref.addEventListener('loadstop', function(event) {
        console.log('Logout finished. ' + JSON.stringify(event));
        $rootScope.data.LoggedIn = false;
        ref.close();
        return login();
      });
    };
    return {
      login: login,
      logout: logout,
      data: data
    };
  });

}).call(this);

//# sourceMappingURL=login.js.map
